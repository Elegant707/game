<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>3D Прототип Игры</title>
<style>
  body { margin: 0; overflow: hidden; background: #87ceeb; }
  canvas { display: block; }
</style>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/three@0.157.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.157.0/examples/js/controls/OrbitControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.157.0/examples/js/objects/Water.js"></script>

<script>
// === Сцена и камера ===
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0, 5, 10);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// === Контроллы камеры ===
const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enablePan = false;

// === Освещение ===
const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
scene.add(ambientLight);
const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
directionalLight.position.set(10,20,10);
scene.add(directionalLight);

// === Игрок (куб) ===
const playerGeo = new THREE.BoxGeometry(1,1,1);
const playerMat = new THREE.MeshStandardMaterial({color:0xff0000});
const player = new THREE.Mesh(playerGeo, playerMat);
player.position.y = 0.5;
scene.add(player);

// === Пол ===
const planeGeo = new THREE.PlaneGeometry(50,50);
const planeMat = new THREE.MeshStandardMaterial({color:0x228B22});
const plane = new THREE.Mesh(planeGeo, planeMat);
plane.rotation.x = -Math.PI/2;
scene.add(plane);

// === Вода ===
const waterGeometry = new THREE.PlaneGeometry(50,50);
const water = new THREE.Water(waterGeometry, {
    color: 0x001e0f,
    scale: 1,
    flowDirection: new THREE.Vector2(1,1),
    textureWidth: 512,
    textureHeight: 512
});
water.rotation.x = -Math.PI/2;
water.position.y = 0;
scene.add(water);

// === Частицы огня ===
const fireParticles = [];
const fireGeo = new THREE.SphereGeometry(0.1,8,8);
const fireMat = new THREE.MeshBasicMaterial({color:0xff6600});
for(let i=0;i<50;i++){
    const p = new THREE.Mesh(fireGeo, fireMat);
    p.position.set(Math.random()*4-2,0.1,Math.random()*4-2);
    scene.add(p);
    fireParticles.push(p);
}

// === Движение игрока ===
const keys = { w:false,a:false,s:false,d:false,Shift:false,Space:false,Control:false };
document.addEventListener('keydown', e => { if(keys.hasOwnProperty(e.key)) keys[e.key]=true; });
document.addEventListener('keyup', e => { if(keys.hasOwnProperty(e.key)) keys[e.key]=false; });

let velocityY = 0;
const speed = 0.1, jumpPower=0.2, gravity=0.01;

function animate(){
    requestAnimationFrame(animate);

    // === Движение ===
    let moveSpeed = keys.Shift ? speed*2 : speed;
    if(keys.w) player.position.z -= moveSpeed;
    if(keys.s) player.position.z += moveSpeed;
    if(keys.a) player.position.x -= moveSpeed;
    if(keys.d) player.position.x += moveSpeed;

    // Прыжки и присед
    if(keys.Space && player.position.y<=0.5) velocityY = jumpPower;
    if(keys.Control) player.scale.y = 0.5; else player.scale.y=1;
    velocityY -= gravity;
    player.position.y += velocityY;
    if(player.position.y<0.5){ player.position.y=0.5; velocityY=0; }

    // Камера следует за игроком
    camera.position.x = player.position.x + 5;
    camera.position.z = player.position.z + 10;
    camera.lookAt(player.position);

    // Обновляем воду
    water.material.uniforms['time'].value += 1.0/60.0;

    // Анимация огня
    fireParticles.forEach(p=>{
        p.position.y += 0.02;
        if(p.position.y>2) p.position.y=0.1;
    });

    renderer.render(scene,camera);
}
animate();

// === Подстройка под размер окна ===
window.addEventListener('resize', ()=>{
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
